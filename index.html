<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nan An</title>
    <link rel="stylesheet" href="stylesheet.css">
    <canvas id="globe"></canvas>
    <script src="globe.js" type="module"></script>
    <script src="animation.js" type="module" defer></script>
    <script src="analytics.js" type="module" defer></script>
    <script src="trefoil.js" type="module" defer></script>
</head>
<body>
    <div id="content">
        <h1>Nan An</h1>
        <p style="width: 70%; color:rgb(122, 122, 122)"><i>Sapiens dominabitur astris</i></p>
        <p style="width: 70%;">Data Scientist, Software Developer,<br> Mathematician, Physist</p>
        <nav><a id="toaboutbutton">Learn more about me ></a></nav>
        <p style="width: 70%;">The interactive globe displays data gathered from my analytics system. The system also stalls malicious requests.</p>
        <nav><a id="tobuildbutton">Learn more about how I built it ></a></nav>
        <p><div>
            <span id="status" style="color: red;">&#x25cf;</span> Analytics Information
            <div>ID: <span id="user-id">Loading...</span></div>
            <div>Location: <span id="user-location">Loading...</span></div>
        </div></p>
        <nav><a id="totrackbutton">Learn more about how I stall requests ></a></nav>
    </div>

    <div id="build">
        <nav><a id="toconbutton">&lt; Back</a></nav>
        <h1>Building My Analytics System</h1>
        <p>
            This system is built mainly on Cloudflare Workers, KV caches, and a D1 database. It also serves some API endpoints to provide frontend data for visualization on the 3D globe.
        </p>
        <h2>Specifications</h2>
        <ul>
            <li>The database logs individual requests made to the website. The schema includes Geolocation, Time, IP, session ID, and a generated user ID. If two records share the same user ID, the system will think they come from the same user.</li>
            <li>The users are tracked by their session IDs and their IPs.</li>
            <li>If there is a session ID that matches, this request is to be assigned with the same user ID.</li>
            <li>If there is an IP address that matches, but the session ID does not, the session ID has been tempered. In that case, reset the session ID with the most recent session ID recorded in the database.</li>
            <li>To optimize, the read & write operations to the database should be cached and batched as much as possible.</li>
            <li>Malicious requests should be redirected to other endpoints for slow-lories.</li>
        </ul>
        <p>This mechanism tries to link sessions by IP and session ID. The session IDs are signed to avoid manipulation. A single user can generate multiple identities by changing IP and clearing browsing data, but in general this should give a reasonable approximation of user activity.</p>
        <h2>Implementation</h2>
        <codeblock>
            -- Architechture Visualization -- <br>
            (w: write, r: read)<br>
            (A -> B) means A initializes requests to B<br><br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(cron)<br>
            Front End &lt;-> Worker A -w-> KV Cache &lt;-r- Worker B -w-> SQL Database<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+-----r----+--- (if cache miss), r---------+<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (Malicious Requests)<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;V<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nginx (redirects to slow-lories)<br>
        </codeblock>
        <ul>
            <li>The tracking script loads on 'mousemove' and 'scroll' events. This filters bot traffic. The script will send a request to a Worker (A).</li>
            <li>A logs the request, along with the IP address and session ID. The geographic location is inferred from the IP address using cloudflare's API.</li>
            <li>A writes to KV cache and reads user ID. It will first try to read from cache. If it is a miss, A will read from the database. Then A sends the user ID back to the frontend.</li>
            <li>Worker B, sitting on a cron trigger that runs every 30 mins, collects the writes registered in cache, and write to the database in batch.</li>
        </ul>
        <h2>KV Cache Design</h2>
        <p>Writes are cached by <code>W-[ID]-[No]: Values</code>. They have a life time of an hour. I added <code>[No]</code> in case there are multiple writes for the same ID. Worker B will collect all of those writes and write to the database in batch.
        </p>
        <p>Reads are cached by <code>R-[ID]: Values</code>, since only the newest read needs to be kept. They have a life time of 5 minutes.
        </p>
        <p>Now when A tries to read, there are potentially three versions of truth: the write-cache, read-cache, and the database itself. A will first try to read from write-cache since it is the freshest, then it will try to read from read-cache, and last the database. The information retrieved by A might be 5 minutes out-of-date due to the inherient nature of caching, but I feel it is acceptable.</p>
        <h2>In the end</h2>
        Thanks to the generosity of cloudflare, all the assets used in this system is free. This system is optimized for high-load scenerios, and is rather easy to scale. It has been very fun to think about and implementing the system :) 
    </div>

    <div id="track">
        <nav><a id="toconbuttontra">&lt; Back</a></nav>
        <h1>--In writing--</h1>
        <p>--I'm going to write something here--</p>
    </div>

    <div id="about"> 
        <nav><a id="toconbuttonabo">&lt; Back</a></nav>
        <h1>Nan An</h1>
        <p><a href="https://github.com/annp0">Resume ></a> <a href="https://github.com/annp0">Github ></a></p>
        <p>
            Email: ann5@mcmaster.ca (Institution), admin@annan.eu.org (Website)
        </p>
        <h2>About Me</h2>
        <div id="aboutme">
            <div>
                <p>I’m a Data Scientist and Software Developer pursuing an M.Sc. in Computer Science at McMaster University. My research focuses on software modeling, and I have experience in machine learning, AI, and data-driven problem-solving. I’ve worked on large-scale data projects at the Ministry of Health and Front Row Ventures. I also contribute to open-source projects like Neo4j.</p>
                <p>Coming from a background in mathematics and physics, I love optimizition and thought experiments. I am an outdoor person and I love nature:</p>
                <div style="text-align: center;">Z = tr(e<sup>-βĤ</sup>) (The Canonical Partition Function)</div>
            </div>
            <div id="knot-container">
                <canvas id="canvas"></canvas>
                <div style="text-align: center;">Trefoil Knot 3<sub>1</sub></div>
            </div>
        </div>
        <div>
            <h2>Experience</h2>
            <ul>
                <li><div>Sep 2024 - Present: Data Scientist<br>
                    <i>Health Science Data Branch, Ontario Ministry of Health</i>
                </div></li>
                <li><div>May 2024 - Jun 2024: Guest Researcher<br> 
                    <i>Hausdorff Institute of Mathematics, Universität Bonn</i>
                </div></li>
                <li><div>Sep 2023 - Aug 2024: Software Developer (Research Assistant)<br>
                    <i>Centre for Software Verification, McMaster University</i>
                </div></li>
                <li><div>Sep 2021 - Aug 2024: Teaching Assistant<br>
                    <i>Shanghaitech (2021 - 2023), McMaster (2023 - 2024)</i>
                </div></li>
            </ul>
        </div>
        <div>
            <h2>Education</h2>
        <ul>
            <li><div>Sep 2023 - Present: Computer Science M. Sc. (Thesis-based)<br>
                <i>McMaster University, Supervised & Funded by Dr. Jacque Carette</i>
            </div></li>
            <li><div>Sep 2019 - Jun 2023: Physics B. Sc.<br> 
                <i>Shanghaitech Univeristy, Thesis: Majorana Fermions and its use in Quantum Computing</i>
            </div></li>
        </ul>
        </div>
        <h2>Data Science Projects</h2>
        <ul>
            <li><a href="https://github.com/annp0/agnn">AGNN</a>: A Graph Neural Network for Fraud Detection [Python]</li>
            <li><a href="https://github.com/annp0/dslib">DSLIB</a>: A Library for Data Science Automation [Python]</li>
        </ul>
        <h2>Software Projects</h2>
        <ul>
            <li><a href="https://github.com/annp0/tfsi">TFSI</a>: A tagless final-style interpreter [Haskell]</li>
            <li><a href="https://github.com/annp0/opentelemetry">OpenTelemetry</a>: A telemetry communication software [Haskell/C++]</li>
            <li><a href="https://github.com/annp0/anregex">AnRegex</a>: A NFA Regex Engine [Python]</li>
            <li><a href="https://github.com/annp0/anrt">AnRT</a>: A 3D Ray Tracing Rendering Engine [C++]</li>
        </ul>
        <h2>Research Project</h2>
        <ul>
            <li><a href="https://github.com/annp0/models-in-agda-pilot">Models in Agda</a>: Showcasing software modeling with dependent types [Agda]</li>
        </ul>
        <div id="Notes">
        <h2>Notes (Mathematics)</h2>
            <ul>
                <li><a href="files/ct-1.pdf">Notes on Natural Transformation</a></li>
                <li><a href="files/notes-on-dt.pdf">Notes on Differential Topology</a></li>
                <li><a href="files/ra-sol-ch1-3.pdf">Solutions to Selected Real Analysis Problems</a></li>
                <li><a href="files/galois.pdf">Introduction to Galois Theory</a></li>
            </ul>
        </div>
    </div>
</body>
</html>

