import{time as l}from"../../frameloop/sync-time-DIkHWTW-.js";import{flushKeyframeResolvers as m}from"../../render/utils/KeyframesResolver-DKGlpZg4.js";import{canAnimate as p}from"./utils/can-animate-vz5l58x6.js";import{getFinalKeyframe as v}from"./waapi/utils/get-final-keyframe-BIaNfY89.js";const c=40;class F{constructor({autoplay:e=!0,delay:t=0,type:i="keyframes",repeat:o=0,repeatDelay:r=0,repeatType:n="loop",...s}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=l.now(),this.options={autoplay:e,delay:t,type:i,repeat:o,repeatDelay:r,repeatType:n,...s},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>c?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&m(),this._resolved}onKeyframesResolved(e,t){this.resolvedAt=l.now(),this.hasAttemptedResolve=!0;const{name:i,type:o,velocity:r,delay:n,onComplete:s,onUpdate:h,isGenerator:a}=this.options;if(!a&&!p(e,i,o,r))if(n)this.options.duration=0;else{h&&h(v(e,this.options,t)),s&&s(),this.resolveFinishedPromise();return}const d=this.initPlayback(e,t);d!==!1&&(this._resolved={keyframes:e,finalKeyframe:t,...d},this.onPostResolved())}onPostResolved(){}then(e,t){return this.currentFinishedPromise.then(e,t)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(e=>{this.resolveFinishedPromise=e})}}export{F as BaseAnimation};
