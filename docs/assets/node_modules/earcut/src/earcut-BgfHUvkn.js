function a(e,t,n=2){const r=t&&t.length,x=r?t[0]*n:e.length;let f=D(e,0,x,n,!0);const i=[];if(!f||f.next===f.prev)return i;let o,l,u;if(r&&(f=N(e,t,f,n)),e.length>80*n){o=1/0,l=1/0;let h=-1/0,p=-1/0;for(let Z=n;Z<x;Z+=n){const g=e[Z],y=e[Z+1];g<o&&(o=g),y<l&&(l=y),g>h&&(h=g),y>p&&(p=y)}u=Math.max(h-o,p-l),u=u!==0?32767/u:0}return k(f,i,n,o,l,u,0),i}function D(e,t,n,r,x){let f;if(x===b(e,t,n,r)>0)for(let i=t;i<n;i+=r)f=B(i/r|0,e[i],e[i+1],f);else for(let i=n-r;i>=t;i-=r)f=B(i/r|0,e[i],e[i+1],f);return f&&F(f,f.next)&&(H(f),f=f.next),f}function w(e,t){if(!e)return e;t||(t=e);let n=e,r;do if(r=!1,!n.steiner&&(F(n,n.next)||v(n.prev,n,n.next)===0)){if(H(n),n=t=n.prev,n===n.next)break;r=!0}else n=n.next;while(r||n!==t);return t}function k(e,t,n,r,x,f,i){if(!e)return;!i&&f&&_(e,r,x,f);let o=e;for(;e.prev!==e.next;){const l=e.prev,u=e.next;if(f?G(e,r,x,f):m(e)){t.push(l.i,e.i,u.i),H(e),e=u.next,o=u.next;continue}if(e=u,e===o){i?i===1?(e=J(w(e),t),k(e,t,n,r,x,f,2)):i===2&&K(e,t,n,r,x,f):k(w(e),t,n,r,x,f,1);break}}}function m(e){const t=e.prev,n=e,r=e.next;if(v(t,n,r)>=0)return!1;const x=t.x,f=n.x,i=r.x,o=t.y,l=n.y,u=r.y,h=Math.min(x,f,i),p=Math.min(o,l,u),Z=Math.max(x,f,i),g=Math.max(o,l,u);let y=r.next;for(;y!==t;){if(y.x>=h&&y.x<=Z&&y.y>=p&&y.y<=g&&L(x,o,f,l,i,u,y.x,y.y)&&v(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function G(e,t,n,r){const x=e.prev,f=e,i=e.next;if(v(x,f,i)>=0)return!1;const o=x.x,l=f.x,u=i.x,h=x.y,p=f.y,Z=i.y,g=Math.min(o,l,u),y=Math.min(h,p,Z),M=Math.max(o,l,u),I=Math.max(h,p,Z),j=C(g,y,t,n,r),A=C(M,I,t,n,r);let c=e.prevZ,s=e.nextZ;for(;c&&c.z>=j&&s&&s.z<=A;){if(c.x>=g&&c.x<=M&&c.y>=y&&c.y<=I&&c!==x&&c!==i&&L(o,h,l,p,u,Z,c.x,c.y)&&v(c.prev,c,c.next)>=0||(c=c.prevZ,s.x>=g&&s.x<=M&&s.y>=y&&s.y<=I&&s!==x&&s!==i&&L(o,h,l,p,u,Z,s.x,s.y)&&v(s.prev,s,s.next)>=0))return!1;s=s.nextZ}for(;c&&c.z>=j;){if(c.x>=g&&c.x<=M&&c.y>=y&&c.y<=I&&c!==x&&c!==i&&L(o,h,l,p,u,Z,c.x,c.y)&&v(c.prev,c,c.next)>=0)return!1;c=c.prevZ}for(;s&&s.z<=A;){if(s.x>=g&&s.x<=M&&s.y>=y&&s.y<=I&&s!==x&&s!==i&&L(o,h,l,p,u,Z,s.x,s.y)&&v(s.prev,s,s.next)>=0)return!1;s=s.nextZ}return!0}function J(e,t){let n=e;do{const r=n.prev,x=n.next.next;!F(r,x)&&R(r,n,n.next,x)&&z(r,x)&&z(x,r)&&(t.push(r.i,n.i,x.i),H(n),H(n.next),n=e=x),n=n.next}while(n!==e);return w(n)}function K(e,t,n,r,x,f){let i=e;do{let o=i.next.next;for(;o!==i.prev;){if(i.i!==o.i&&Y(i,o)){let l=V(i,o);i=w(i,i.next),l=w(l,l.next),k(i,t,n,r,x,f,0),k(l,t,n,r,x,f,0);return}o=o.next}i=i.next}while(i!==e)}function N(e,t,n,r){const x=[];for(let f=0,i=t.length;f<i;f++){const o=t[f]*r,l=f<i-1?t[f+1]*r:e.length,u=D(e,o,l,r,!1);u===u.next&&(u.steiner=!0),x.push(X(u))}x.sort(Q);for(let f=0;f<x.length;f++)n=S(x[f],n);return n}function Q(e,t){let n=e.x-t.x;if(n===0&&(n=e.y-t.y,n===0)){const r=(e.next.y-e.y)/(e.next.x-e.x),x=(t.next.y-t.y)/(t.next.x-t.x);n=r-x}return n}function S(e,t){const n=U(e,t);if(!n)return t;const r=V(n,e);return w(r,r.next),w(n,n.next)}function U(e,t){let n=t;const r=e.x,x=e.y;let f=-1/0,i;if(F(e,n))return n;do{if(F(e,n.next))return n.next;if(x<=n.y&&x>=n.next.y&&n.next.y!==n.y){const p=n.x+(x-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(p<=r&&p>f&&(f=p,i=n.x<n.next.x?n:n.next,p===r))return i}n=n.next}while(n!==t);if(!i)return null;const o=i,l=i.x,u=i.y;let h=1/0;n=i;do{if(r>=n.x&&n.x>=l&&r!==n.x&&O(x<u?r:f,x,l,u,x<u?f:r,x,n.x,n.y)){const p=Math.abs(x-n.y)/(r-n.x);z(n,e)&&(p<h||p===h&&(n.x>i.x||n.x===i.x&&W(i,n)))&&(i=n,h=p)}n=n.next}while(n!==o);return i}function W(e,t){return v(e.prev,e,t.prev)<0&&v(t.next,e,e.next)<0}function _(e,t,n,r){let x=e;do x.z===0&&(x.z=C(x.x,x.y,t,n,r)),x.prevZ=x.prev,x.nextZ=x.next,x=x.next;while(x!==e);x.prevZ.nextZ=null,x.prevZ=null,$(x)}function $(e){let t,n=1;do{let r=e,x;e=null;let f=null;for(t=0;r;){t++;let i=r,o=0;for(let u=0;u<n&&(o++,i=i.nextZ,!!i);u++);let l=n;for(;o>0||l>0&&i;)o!==0&&(l===0||!i||r.z<=i.z)?(x=r,r=r.nextZ,o--):(x=i,i=i.nextZ,l--),f?f.nextZ=x:e=x,x.prevZ=f,f=x;r=i}f.nextZ=null,n*=2}while(t>1);return e}function C(e,t,n,r,x){return e=(e-n)*x|0,t=(t-r)*x|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function X(e){let t=e,n=e;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==e);return n}function O(e,t,n,r,x,f,i,o){return(x-i)*(t-o)>=(e-i)*(f-o)&&(e-i)*(r-o)>=(n-i)*(t-o)&&(n-i)*(f-o)>=(x-i)*(r-o)}function L(e,t,n,r,x,f,i,o){return!(e===i&&t===o)&&O(e,t,n,r,x,f,i,o)}function Y(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!d(e,t)&&(z(e,t)&&z(t,e)&&q(e,t)&&(v(e.prev,e,t.prev)||v(e,t.prev,t))||F(e,t)&&v(e.prev,e,e.next)>0&&v(t.prev,t,t.next)>0)}function v(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function F(e,t){return e.x===t.x&&e.y===t.y}function R(e,t,n,r){const x=P(v(e,t,n)),f=P(v(e,t,r)),i=P(v(n,r,e)),o=P(v(n,r,t));return!!(x!==f&&i!==o||x===0&&E(e,n,t)||f===0&&E(e,r,t)||i===0&&E(n,e,r)||o===0&&E(n,t,r))}function E(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function P(e){return e>0?1:e<0?-1:0}function d(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&R(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}function z(e,t){return v(e.prev,e,e.next)<0?v(e,t,e.next)>=0&&v(e,e.prev,t)>=0:v(e,t,e.prev)<0||v(e,e.next,t)<0}function q(e,t){let n=e,r=!1;const x=(e.x+t.x)/2,f=(e.y+t.y)/2;do n.y>f!=n.next.y>f&&n.next.y!==n.y&&x<(n.next.x-n.x)*(f-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next;while(n!==e);return r}function V(e,t){const n=T(e.i,e.x,e.y),r=T(t.i,t.x,t.y),x=e.next,f=t.prev;return e.next=t,t.prev=e,n.next=x,x.prev=n,r.next=n,n.prev=r,f.next=r,r.prev=f,r}function B(e,t,n,r){const x=T(e,t,n);return r?(x.next=r.next,x.prev=r,r.next.prev=x,r.next=x):(x.prev=x,x.next=x),x}function H(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function T(e,t,n){return{i:e,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function b(e,t,n,r){let x=0;for(let f=t,i=n-r;f<n;f+=r)x+=(e[i]-e[f])*(e[f+1]+e[i+1]),i=f;return x}function ee(e){const t=[],n=[],r=e[0][0].length;let x=0,f=0;for(const i of e){for(const o of i)for(let l=0;l<r;l++)t.push(o[l]);f&&(x+=f,n.push(x)),f=i.length}return{vertices:t,holes:n,dimensions:r}}export{a as default,ee as flatten};
