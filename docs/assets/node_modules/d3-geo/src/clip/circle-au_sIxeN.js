import{cartesian as Q,cartesianCross as T,cartesianDot as P,cartesianScale as R,cartesianAddInPlace as w,spherical as U}from"../cartesian-0PBFRGIL.js";import{circleStream as $}from"../circle-7yKy2MBx.js";import{pi as v,cos as y,abs as F,epsilon as g,sqrt as b,radians as m}from"../math-yk45OU_y.js";import G from"../pointEqual-C9HG-HUx.js";import nn from"./index-DqX3ZmOM.js";function cn(d){var x=y(d),V=2*m,A=x>0,W=F(x)>g;function X(n,i,o,e){$(e,d,V,o,n,i)}function J(n,i){return y(n)*y(i)>x}function Y(n){var i,o,e,C,a;return{lineStart:function(){C=e=!1,a=1},point:function(f,u){var t=[f,u],r,c=J(f,u),H=A?c?0:K(f,u):c?K(f+(f<0?v:-v),u):0;if(!i&&(C=e=c)&&n.lineStart(),c!==e&&(r=D(i,t),(!r||G(i,r)||G(t,r))&&(t[2]=1)),c!==e)a=0,c?(n.lineStart(),r=D(t,i),n.point(r[0],r[1])):(r=D(i,t),n.point(r[0],r[1],2),n.lineEnd()),i=r;else if(W&&i&&A^c){var l;!(H&o)&&(l=D(t,i,!0))&&(a=0,A?(n.lineStart(),n.point(l[0][0],l[0][1]),n.point(l[1][0],l[1][1]),n.lineEnd()):(n.point(l[1][0],l[1][1]),n.lineEnd(),n.lineStart(),n.point(l[0][0],l[0][1],3)))}c&&(!i||!G(i,t))&&n.point(t[0],t[1]),i=t,e=c,o=H},lineEnd:function(){e&&n.lineEnd(),i=null},clean:function(){return a|(C&&e)<<1}}}function D(n,i,o){var e=Q(n),C=Q(i),a=[1,0,0],f=T(e,C),u=P(f,f),t=f[0],r=u-t*t;if(!r)return!o&&n;var c=x*u/r,H=-x*t/r,l=T(a,f),S=R(a,c),Z=R(f,H);w(S,Z);var z=l,I=P(S,z),h=P(z,z),M=I*I-h*(P(S,S)-1);if(!(M<0)){var N=b(M),p=R(z,(-I-N)/h);if(w(p,S),p=U(p),!o)return p;var s=n[0],B=i[0],E=n[1],q=i[1],L;B<s&&(L=s,s=B,B=L);var j=B-s,k=F(j-v)<g,_=k||j<g;if(!k&&q<E&&(L=E,E=q,q=L),_?k?E+q>0^p[1]<(F(p[0]-s)<g?E:q):E<=p[1]&&p[1]<=q:j>v^(s<=p[0]&&p[0]<=B)){var O=R(z,(-I+N)/h);return w(O,S),[p,U(O)]}}}function K(n,i){var o=A?d:v-d,e=0;return n<-o?e|=1:n>o&&(e|=2),i<-o?e|=4:i>o&&(e|=8),e}return nn(J,Y,X,A?[0,-d]:[-v,d-v])}export{cn as default};
