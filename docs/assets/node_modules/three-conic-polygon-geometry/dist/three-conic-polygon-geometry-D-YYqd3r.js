import"../../three/build/three.module-DDr6UARD.js";import or,{flatten as D}from"../../earcut/src/earcut-BgfHUvkn.js";import ar from"../../delaunator/index-CfVLg6Lq.js";import ir from"../../@turf/boolean-point-in-polygon/dist/esm/index-nE9prtKM.js";import{BufferGeometry as ur,Float32BufferAttribute as sr}from"../../three/build/three.core-BhFki44V.js";import z from"../../d3-array/src/merge-B2F1fGzm.js";import rr from"../../d3-geo/src/bounds-D5p7TPhU.js";import{geoVoronoi as fr}from"../../d3-geo-voronoi/src/voronoi-7JgubAY1.js";import X from"../../d3-scale/src/linear-EAbKQ90K.js";import Y from"../../d3-array/src/extent-ColhFGRq.js";import cr from"../../d3-geo/src/contains-DLsW2PNL.js";import lr from"../../d3-array/src/mean-BY1qJKuM.js";import vr from"../../d3-geo/src/distance-BiWJ7apk.js";import mr from"../../d3-geo/src/interpolate-CWAikPKj.js";function H(r,n){(n==null||n>r.length)&&(n=r.length);for(var t=0,e=Array(n);t<n;t++)e[t]=r[t];return e}function pr(r){if(Array.isArray(r))return r}function gr(r){if(Array.isArray(r))return H(r)}function dr(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function hr(r,n,t){return n=N(n),Mr(r,nr()?Reflect.construct(n,[],N(r).constructor):n.apply(r,t))}function yr(r,n){if(!(r instanceof n))throw new TypeError("Cannot call a class as a function")}function br(r,n,t){return Object.defineProperty(r,"prototype",{writable:!1}),r}function N(r){return N=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},N(r)}function _r(r,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(n&&n.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),n&&J(r,n)}function nr(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(nr=function(){return!!r})()}function Pr(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function wr(r,n){var t=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(t!=null){var e,o,s,u,a=[],f=!0,i=!1;try{if(s=(t=t.call(r)).next,n!==0)for(;!(f=(e=s.call(t)).done)&&(a.push(e.value),a.length!==n);f=!0);}catch(p){i=!0,o=p}finally{try{if(!f&&t.return!=null&&(u=t.return(),Object(u)!==u))return}finally{if(i)throw o}}return a}}function Lr(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ar(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Mr(r,n){if(n&&(typeof n=="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return dr(r)}function J(r,n){return J=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},J(r,n)}function L(r,n){return pr(r)||wr(r,n)||tr(r,n)||Lr()}function q(r){return gr(r)||Pr(r)||tr(r)||Ar()}function tr(r,n){if(r){if(typeof r=="string")return H(r,n);var t={}.toString.call(r).slice(8,-1);return t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set"?Array.from(r):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?H(r,n):void 0}}function Or(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=n.resolution,e=t===void 0?1/0:t,o=Cr(r,e),s=z(o),u=jr(r,e),a=[].concat(q(s),q(u)),f={type:"Polygon",coordinates:r},i=rr(f),p=L(i,2),_=L(p[0],2),P=_[0],S=_[1],g=L(p[1],2),C=g[0],c=g[1],y=P>C||c>=89||S<=-89,j=[];if(y){var V=fr(a).triangles(),U=new Map(a.map(function(l,b){var h=L(l,2),v=h[0],O=h[1];return["".concat(v,"-").concat(O),b]}));V.features.forEach(function(l){var b,h=l.geometry.coordinates[0].slice(0,3).reverse(),v=[];if(h.forEach(function(F){var w=L(F,2),W=w[0],er=w[1],Q="".concat(W,"-").concat(er);U.has(Q)&&v.push(U.get(Q))}),v.length===3){if(v.some(function(F){return F<s.length})){var O=l.properties.circumcenter;if(!K(O,f,y))return}(b=j).push.apply(b,v)}})}else if(u.length)for(var M=ar.from(a),E=function(b){var h,v=[2,1,0].map(function(w){return M.triangles[b+w]}),O=v.map(function(w){return a[w]});if(v.some(function(w){return w<s.length})){var F=[0,1].map(function(w){return lr(O,function(W){return W[w]})});if(!K(F,f,y))return 1}(h=j).push.apply(h,q(v))},T=0,d=M.triangles.length;T<d;T+=3)E(T);else{var x=D(o),A=x.vertices,m=x.holes,B=m===void 0?[]:m;j=or(A,B,2)}var R=X(Y(a,function(l){return l[0]}),[0,1]),G=X(Y(a,function(l){return l[1]}),[0,1]),$=a.map(function(l){var b=L(l,2),h=b[0],v=b[1];return[R(h),G(v)]}),I={points:a,indices:j,uvs:$};return{contour:o,triangles:I}}function Cr(r,n){return r.map(function(t){var e=[],o;return t.forEach(function(s){if(o){var u=vr(s,o)*180/Math.PI;if(u>n)for(var a=mr(o,s),f=1/Math.ceil(u/n),i=f;i<1;)e.push(a(i)),i+=f}e.push(o=s)}),e})}function jr(r,n){var t={type:"Polygon",coordinates:r},e=rr(t),o=L(e,2),s=L(o[0],2),u=s[0],a=s[1],f=L(o[1],2),i=f[0],p=f[1];if(Math.min(Math.abs(i-u),Math.abs(p-a))<n)return[];var _=u>i||p>=89||a<=-89;return Br(n,{minLng:u,maxLng:i,minLat:a,maxLat:p}).filter(function(P){return K(P,t,_)})}function Br(r){for(var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=n.minLng,e=n.maxLng,o=n.minLat,s=n.maxLat,u=Math.round(Math.pow(360/r,2)/Math.PI),a=(1+Math.sqrt(5))/2,f=function(y){return y/a*360%360-180},i=function(y){return Math.acos(2*y/u-1)/Math.PI*180-90},p=function(y){return u*(Math.cos((y+90)*Math.PI/180)+1)/2},_=[s!==void 0?Math.ceil(p(s)):0,o!==void 0?Math.floor(p(o)):u-1],P=t===void 0&&e===void 0?function(){return!0}:t===void 0?function(c){return c<=e}:e===void 0?function(c){return c>=t}:e>=t?function(c){return c>=t&&c<=e}:function(c){return c>=t||c<=e},S=[],g=_[0];g<=_[1];g++){var C=f(g);P(C)&&S.push([C,i(g)])}return S}function K(r,n){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return t?cr(n,r):ir(r,n)}var k=window.THREE?window.THREE:{BufferGeometry:ur,Float32BufferAttribute:sr},Z=new k.BufferGeometry().setAttribute?"setAttribute":"addAttribute",zr=function(r){function n(t,e,o,s,u,a,f){var i;yr(this,n),i=hr(this,n),i.type="ConicPolygonGeometry",i.parameters={polygonGeoJson:t,bottomHeight:e,topHeight:o,closedBottom:s,closedTop:u,includeSides:a,curvatureResolution:f},e=e||0,o=o||1,s=s!==void 0?s:!0,u=u!==void 0?u:!0,a=a!==void 0?a:!0,f=f||5;var p=Or(t,{resolution:f}),_=p.contour,P=p.triangles,S=z(P.uvs),g=[],C=[],c=[],y=0,j=function(m){var B=Math.round(g.length/3),M=c.length;g=g.concat(m.vertices),C=C.concat(m.uvs),c=c.concat(B?m.indices.map(function(E){return E+B}):m.indices),i.addGroup(M,c.length-M,y++)};a&&j(U()),s&&j(x(e,!1)),u&&j(x(o,!0)),i.setIndex(c),i[Z]("position",new k.Float32BufferAttribute(g,3)),i[Z]("uv",new k.Float32BufferAttribute(C,2)),i.computeVertexNormals();function V(A,m){var B=typeof m=="function"?m:function(){return m},M=A.map(function(E){return E.map(function(T){var d=L(T,2),R=d[0],G=d[1];return Er(G,R,B(R,G))})});return D(M)}function U(){for(var A=V(_,e),m=A.vertices,B=A.holes,M=V(_,o),E=M.vertices,T=z([E,m]),d=Math.round(E.length/3),R=new Set(B),G=0,$=[],I=0;I<d;I++){var l=I+1;if(l===d)l=G;else if(R.has(l)){var b=l;l=G,G=b}$.push(I,I+d,l+d),$.push(l+d,l,I)}for(var h=[],v=1;v>=0;v--)for(var O=0;O<d;O+=1)h.push(O/(d-1),v);return{indices:$,vertices:T,uvs:h}}function x(A){var m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return{indices:m?P.indices:P.indices.slice().reverse(),vertices:V([P.points],A).vertices,uvs:S}}return i}return _r(n,r),br(n)}(k.BufferGeometry);function Er(r,n){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,e=(90-r)*Math.PI/180,o=(90-n)*Math.PI/180;return[t*Math.sin(e)*Math.cos(o),t*Math.cos(e),t*Math.sin(e)*Math.sin(o)]}export{zr as default};
